01 ; PGE TEST IN ASSEMBLER
02 ;
03 ; CODED BY>JOHAN TIBBELIN
04 ; DATE: 2020-05-25
05 ; LAST CHANGED: 2020-05-29
06 ;
07       .OPT NO LIST
08       .OPT OBJ
09 SCR   =   $FA
10       *=  $4000
14 ; STORE SCREEN ADRESS IN Z-PAGE
15       LDA #$00
16       STA $FA
17       LDA #$62
18       STA $FB
19 ; SET ADRESS FOR DISPLAY LIST
20       LDA #$00
30       STA 560
40       LDA #$58
50       STA 561
59 ; SET VBI
60       LDX #VBI/255
70       LDY #VBI&255
80       LDA #7
90       JSR $E45C
99 ; SET DLI ADRESS
0100     LDA #DLI&255
0110     STA $0200
0120     LDA #DLI/255
0130     STA $0201
0139 ; ENABLE DLI
0140     LDA #$C0
0150     STA $D40E
0157 ;
0158 ; MAIN LOOP
0159 ;
0160 MAIN_LOOP
0170     LDX #0
0180     LDY #16
0190 CL1 LDA #$AA
0200     STA $6200
0210     STA $6201
0215     ADC #1
0216     STA SCR
0220     STA $6202
0230     STA $6203
0240     STA (SCR,X)
0250     INX 
0260     STA (SCR,X)
0270     LDA SCR
0280     CLC 
0290     ADC #36
0292     STA SCR
0300     LDA SCR+1
0310     ADC #0
0312     STA SCR+1
0315     LDX #0
0320     DEY 
0330     BNE CL1
0480 STAY JMP STAY
0490 COLI .BYTE $00
0495 COL .BYTE $20,$50,$20,$10,$17
0496     .BYTE $00,$00,$00,$00,$00,$00
0497 VBIC .BYTE $00
0498 FRAMEC .BYTE $00
0500 DLI
0510     PHA 
0520     TXA 
0530     PHA 
0540     LDX COLI
0550     LDA COL,X
0570     STA $02C6
0590     PLA 
0591     TAX 
0592     PLA 
0593     RTI 
0699 ;
0700 ; VBI
0701 ;
0710 VBI
0720     LDA #0
0730     STA $02C6
0740     LDA #$00
0750     STA COLI
0760     LDA VBIC
0770     ADC #1
0775     CLC 
0780     STA VBIC
0790     CMP #50
0800     BNE N50
0850 N50
0860     JMP $E462
1000     *=  $5800
1005 ;    DISPLAY LIST
1010     .BYTE $F0
1015 ; 1 ROW OF MODE 2 AND
1016 ; 1 ROW OF MODE 7
1020     .BYTE $42,$00,$60
1030     .BYTE $47,$00,$61
1035 ; ROW 1 OF 16 LINES
1040     .BYTE $4E,$00,$62
1050     .BYTE $0E,$0E,$0E
1060     .BYTE $0E,$0E,$0E,$0E
1070     .BYTE $0E,$0E,$0E,$0E
1080     .BYTE $0E,$0E,$0E,$0E
1095 ; ROW 2 OF 16 LINES
1100     .BYTE $4E,$00,$65
1110     .BYTE $0E,$0E,$0E
1120     .BYTE $0E,$0E,$0E,$0E
1130     .BYTE $0E,$0E,$0E,$0E
1140     .BYTE $0E,$0E,$0E,$0E
1195 ; ROW 3 OF 16 LINES
1200     .BYTE $4E,$00,$68
1210     .BYTE $0E,$0E,$0E
1220     .BYTE $0E,$0E,$0E,$0E
1230     .BYTE $0E,$0E,$0E,$0E
1240     .BYTE $0E,$0E,$0E,$0E
1295 ; ROW 4 OF 16 LINES
1300     .BYTE $4E,$00,$71
1310     .BYTE $0E,$0E,$0E
1320     .BYTE $0E,$0E,$0E,$0E
1330     .BYTE $0E,$0E,$0E,$0E
1340     .BYTE $0E,$0E,$0E,$0E
1395 ; ROW 5 OF 16 LINES
1400     .BYTE $4E,$00,$74
1410     .BYTE $0E,$0E,$0E
1420     .BYTE $0E,$0E,$0E,$0E
1430     .BYTE $0E,$0E,$0E,$0E
1440     .BYTE $0E,$0E,$0E,$0E
1495 ; ROW 6 OF 16 LINES
1500     .BYTE $4E,$00,$77
1510     .BYTE $0E,$0E,$0E
1520     .BYTE $0E,$0E,$0E,$0E
1530     .BYTE $0E,$0E,$0E,$0E
1540     .BYTE $0E,$0E,$0E,$0E
1550     .BYTE $70,$70,$70,$70
1560     .BYTE $70,$70,$70,$70
1570     .BYTE $70,$70,$70,$70
1580     .BYTE $70,$30
1600     .BYTE 41,$00,$58
2000 ; FIRST ROWS OF GFX
2010     *=  $6000
2020     .BYTE $00,$00,$00,$00,$00
2021     .BYTE $00,$00,$00,$00,$00
2022     .BYTE $00,$00,$00,$00,$00
2023     .BYTE $00,$00,$00,$00,$00
2024     .BYTE $00,$00,$00,$00,$00
2025     .BYTE $00,$00,$00,$00,$00
2026     .BYTE "fps",$00,$00,$00,$00,$00
2030     *=  $6100
2040     .BYTE $30,"ixel",$27,"ame",$25,"ngine",$00
2045     .BYTE $12,$0E,$10
2050     *=  $6200
2060     .BYTE $AA,$AA,$AA,$AA
2070     .BYTE $BB,$BB,$BB,$BB
2080     *=  $7700
2090     .BYTE $AA,$AA,$AA,$AA
3000 ; PLOT PIXEL
3010 PLOTP
3015     *=  $4200
3016     STX $F4
3017     TXA 
3018     AND #$FC
3019     STA $F5
3020     LDA $F4
3030     LSR A
3040     LSR A
3050     TAX 
3060     LDA #$00
3070     STA $F0
3080     LDA #$62
3090     STA $F1
3100 ADDY
3110     CLC 
3120     LDA $F0
3130     ADC #40
3140     STA $F0
3150     LDA $F1
3160     ADC #0
3170     STA $F1
3180     DEY 
3190     BNE ADDY
3200 ; ADD X POS
3210     CLC 
3220     LDA $F0
3230     STX $F2
3235     ADC $F2
3240     STA $F0
3250     LDA $F1
3260     ADC #0
3270     STA $F1
3275     LDY #0
3276     LDA ($F0),Y
3277     AND MASK
3278     ORA DATA
3279     STA ($F0),Y
3290     RTS 
3300 MASK .BYTE $00
3310 DATA .BYTE $AA
4000 ; CALC Y
4005     *=  $4300
4010 CALCY
4015 ; LOW BYTE ADDRESS
4020     LDA #$00
4030     STA $F4
4040     LDA #$50
4050     STA $F5
4055 ; HIGH BYTE ADDRESS
4060     LDA #$00
4070     STA $F6
4080     LDA #$52
4090     STA $F7
4100     LDX #191
4105     LDA #0
4106     STA $5000
4107     STA $5200
4108     LDA #$00
4109     STA $F0
4110     STA $F1
4111 XL1
4120     CLC 
4125     LDA $F0
4130     ADC #40
4140     STA $F0
4150     LDA $F1
4160     ADC #0
4170     STA $F1
4180     CLC 
4190     LDA $F4
4200     ADC #1
4210     STA $F4
4220     LDA $F5
4230     ADC #0
4240     STA $F5
4250     CLC 
4260     LDA $F6
4270     ADC #1
4280     STA $F6
4290     LDA $F7
4300     ADC #0
4310     STA $F7
4320     LDY #0
4330     LDA $F0
4340     STA ($F4),Y
4350     LDA $F1
4360     STA ($F6),Y
4370     DEX 
4380     BNE XL1
4390     RTS 
