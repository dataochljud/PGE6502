01 ; PGE TEST IN ASSEMBLER
02 ;
03 ; CODED BY>JOHAN TIBBELIN
04 ; DATE: 2020-05-25
05 ; LAST CHANGED: 2020-06-01
06 ;
07       .OPT NO LIST
08       .OPT OBJ
09 SCR   =   $FA
10       *=  $4000
11 INIT
14 ; STORE SCREEN ADRESS IN Z-PAGE
15       LDA #$00
16       STA $FA
17       LDA #$62
18       STA $FB
19 ; SET ADRESS FOR DISPLAY LIST
20       LDA #$00
30       STA 560
40       LDA #$58
50       STA 561
59 ; SET VBI
60       LDX #$50
70       LDY #$00
80       LDA #7
90       JSR $E45C
99 ; SET DLI ADRESS
0100     LDA #DLI&255
0110     STA $0200
0120     LDA #DLI/255
0130     STA $0201
0139 ; ENABLE DLI
0140     LDA #$C0
0150     STA $D40E
0151 ; INIT POKEY
0152 ; (USED FOR RANDOM NUMERS)
0153     LDA #0
0154     STA $D208
0155     LDA #3
0156     STA $D20F
0157     STA $D209
0158 ; MAIN LOOP
0159 ;
0160 MAIN_LOOP
0170     LDY #0
0175     LDA #5
0176     STA $F0
0178     JSR CLRSCR
0180     JSR GETCOLOR
0185     STA $F1
0191     LDA #ROWST&255
0192     STA $F2
0193     LDA #ROWST/255
0194     STA $F3
0195     LDX #15
0197 CL1
0198     LDA $F1
0199     LDY #0
0200     STA ($FA),Y
0210     INY 
0220     STA ($FA),Y
0230     INY 
0240     STA ($FA),Y
0250     INY 
0260     STA ($FA),Y
0270     LDA SCR
0280     CLC 
0290     ADC #40
0292     STA SCR
0300     LDA SCR+1
0310     ADC #0
0312     STA SCR+1
0320     DEX 
0330     BNE CL1
0340     LDX #15
0345     LDA $F2
0346     STA $FB
0347     LDA #0
0348     STA $FA
0350     JSR GETCOLOR
0351     STA $F1
0353     INC $F2
0354     LDY #0
0355     LDA ($F2),Y
0356     STA $FB
0357     STY $FA
0358     CMP #$FF
0359     BEQ STAY
0360     DEC $F0
0370     BNE CL1
0480 STAY JMP STAY
0485 ROWST .BYTE $62,$65,$68,$71,$74
0486     .BYTE $77,$FF
0490 COLI .BYTE $00
0495 COL .BYTE $20,$50,$20,$10,$17
0496     .BYTE $00,$00,$00,$00,$00,$00
0497 VBIC .BYTE $00
0498 FRAMEC .BYTE $00
0500 DLI
0510     PHA 
0520     TXA 
0530     PHA 
0540     LDX COLI
0550     LDA COL,X
0570     STA $02C6
0590     PLA 
0591     TAX 
0592     PLA 
0593     RTI 
0699 ;
0700 ; VBI
0701 ;
0705     *=  $5000
0710 VBI
0720     LDA #0
0730     STA $02C6
0740     LDA #$00
0750     STA COLI
0760     LDA VBIC
0770     ADC #1
0775     CLC 
0780     STA VBIC
0790     CMP #50
0800     BNE N50
0850 N50
0860     JMP $E462
1000     *=  $5800
1005 ;    DISPLAY LIST
1010     .BYTE $F0
1015 ; 1 ROW OF MODE 2 AND
1016 ; 1 ROW OF MODE 7
1020     .BYTE $42,$00,$60
1030     .BYTE $47,$00,$61
1035 ; ROW 1 OF 16 LINES
1040     .BYTE $4E,$00,$62
1050     .BYTE $0E,$0E,$0E
1060     .BYTE $0E,$0E,$0E,$0E
1070     .BYTE $0E,$0E,$0E,$0E
1080     .BYTE $0E,$0E,$0E,$0E
1095 ; ROW 2 OF 16 LINES
1100     .BYTE $4E,$00,$65
1110     .BYTE $0E,$0E,$0E
1120     .BYTE $0E,$0E,$0E,$0E
1130     .BYTE $0E,$0E,$0E,$0E
1140     .BYTE $0E,$0E,$0E,$0E
1195 ; ROW 3 OF 16 LINES
1200     .BYTE $4E,$00,$68
1210     .BYTE $0E,$0E,$0E
1220     .BYTE $0E,$0E,$0E,$0E
1230     .BYTE $0E,$0E,$0E,$0E
1240     .BYTE $0E,$0E,$0E,$0E
1295 ; ROW 4 OF 16 LINES
1300     .BYTE $4E,$00,$71
1310     .BYTE $0E,$0E,$0E
1320     .BYTE $0E,$0E,$0E,$0E
1330     .BYTE $0E,$0E,$0E,$0E
1340     .BYTE $0E,$0E,$0E,$0E
1395 ; ROW 5 OF 16 LINES
1400     .BYTE $4E,$00,$74
1410     .BYTE $0E,$0E,$0E
1420     .BYTE $0E,$0E,$0E,$0E
1430     .BYTE $0E,$0E,$0E,$0E
1440     .BYTE $0E,$0E,$0E,$0E
1495 ; ROW 6 OF 16 LINES
1500     .BYTE $4E,$00,$77
1510     .BYTE $0E,$0E,$0E
1520     .BYTE $0E,$0E,$0E,$0E
1530     .BYTE $0E,$0E,$0E,$0E
1540     .BYTE $0E,$0E,$0E,$0E
1550     .BYTE $70,$70,$70,$70
1560     .BYTE $70,$70,$70,$70
1570     .BYTE $70,$70,$70,$70
1580     .BYTE $70,$30
1600     .BYTE 41,$00,$58
2000 ; FIRST ROWS OF GFX
2010     *=  $6000
2020     .BYTE $00,$00,$00,$00,$00
2021     .BYTE $00,$00,$00,$00,$00
2022     .BYTE $00,$00,$00,$00,$00
2023     .BYTE $00,$00,$00,$00,$00
2024     .BYTE $00,$00,$00,$00,$00
2025     .BYTE $00,$00,$00,$00,$00
2026     .BYTE "fps",$00,$00,$00,$00,$00
2030     *=  $6100
2040     .BYTE $30,"ixel",$27,"ame",$25,"ngine",$00
2045     .BYTE $12,$0E,$10
2050     *=  $6200
2060     .BYTE $AA,$AA,$AA,$AA
2070     .BYTE $BB,$BB,$BB,$BB
2080     *=  $7700
2090     .BYTE $AA,$AA,$AA,$AA
3000 ; PLOT PIXEL
3010 PLOTP
3015     *=  $4200
3016     STX $F4
3017     TXA 
3018     AND #$FC
3019     STA $F5
3020     LDA $F4
3030     LSR A
3040     LSR A
3050     TAX 
3060     LDA #$00
3070     STA $F0
3080     LDA #$62
3090     STA $F1
3100 ADDY
3110     CLC 
3120     LDA $F0
3130     ADC #40
3140     STA $F0
3150     LDA $F1
3160     ADC #0
3170     STA $F1
3180     DEY 
3190     BNE ADDY
3200 ; ADD X POS
3210     CLC 
3220     LDA $F0
3230     STX $F2
3235     ADC $F2
3240     STA $F0
3250     LDA $F1
3260     ADC #0
3270     STA $F1
3275     LDY #0
3276     LDA ($F0),Y
3277     AND MASK
3278     ORA DATA
3279     STA ($F0),Y
3290     RTS 
3300 MASK .BYTE $00
3310 DATA .BYTE $AA
4000 ; CALC Y
4005     *=  $4300
4010 CALCY
4015 ; LOW BYTE ADDRESS
4020     LDA #$00
4030     STA $F4
4040     LDA #$50
4050     STA $F5
4055 ; HIGH BYTE ADDRESS
4060     LDA #$00
4070     STA $F6
4080     LDA #$52
4090     STA $F7
4100     LDX #191
4105     LDA #0
4106     STA $5000
4107     STA $5200
4108     LDA #$00
4109     STA $F0
4110     STA $F1
4111 XL1
4120     CLC 
4125     LDA $F0
4130     ADC #40
4140     STA $F0
4150     LDA $F1
4160     ADC #0
4170     STA $F1
4180     CLC 
4190     LDA $F4
4200     ADC #1
4210     STA $F4
4220     LDA $F5
4230     ADC #0
4240     STA $F5
4250     CLC 
4260     LDA $F6
4270     ADC #1
4280     STA $F6
4290     LDA $F7
4300     ADC #0
4310     STA $F7
4320     LDY #0
4330     LDA $F0
4340     STA ($F4),Y
4350     LDA $F1
4360     STA ($F6),Y
4370     DEX 
4380     BNE XL1
4390     RTS 
5000 ; CLEAR SCREEN
5005     *=  $4400
5006 CLRSCR
5010     LDX #$62
5020     LDY #$00
5030     STY $FE
5040     STX $FF
5045     LDY #0
5046     LDX #20
5050 CLRLOOP
5060     LDA #0
5070     STA ($FE),Y
5080     INY 
5090     BNE CLRLOOP
5100     INC $FF
5140     DEX 
5150     BNE CLRLOOP
5160     RTS 
6000 ; TEST PROGRAM START HERE
6005     *=  $4500
6010 TESTPRG
6020     JSR CLRSCR
6025     JSR INIT
6030 STOP JMP STOP
7000 ; DRAW RECT
7005     *=  $4600
7010 DRAW_RECT
7020     STX RX
7030     STY RY
7040     LDA #$00
7050     STA $F0
7060     LDA #$62
7070     STA $F1
7080     LDX #15
7090 DRLOOP
7100     CLC 
7110     LDA $F0
7120     ADC #40
7130     STA $F0
7140     LDA $F1
7150     ADC #0
7160     STA $F1
7170     DEX 
7180     BNE DRLOOP
7190     DEY 
7200     LDX #15
7210     BNE DRLOOP
7220     LDA RX
7230     LSR A
7240     LSR A
7250     CLC 
7260     ADC $F0
7270     STA $F0
7280     LDA $F1
7290     ADC #0
7300     STA $F1
7310 ; DRAW
7312     JSR GETCOLOR
7320     LDX #15
7330 DRL1 LDY #0
7340     STA ($F0),Y
7350     INY 
7360     STA ($F0),Y
7370     INY 
7380     STA ($F0),Y
7390     INY 
7400     STA ($F0),Y
7410     DEX 
7420     BNE DRL1
7430     RTS 
7800 RX  .BYTE $00
7810 RY  .BYTE $00
7999     *=  $4700
8000 GETCOLOR
8010 ; GET RANDOM NUMBER
8020     LDA $D20A
8030     AND #$03
8040     CMP #$01
8050     BNE NOT1
8060     LDA #$55
8065     JMP FIN
8070 NOT1 CMP #$02
8080     BNE NOT2
8090     LDA #$AA
8095     JMP FIN
8100 NOT2 CMP #$03
8110     BNE NOT3
8120     LDA #$FF
8130     JMP FIN
8140 NOT3 LDA #$00
8150 FIN RTS 
8999     *=  $4800
9000 NEWDRAW
9002     LDA #$00
9004     STA $FA
9006     LDA #$62
9008     STA $FB
9010 ; GENERATE COLOR DATA
9012     LDA #PXDATA&255
9014     STA $E0
9016     LDA #PXDATA/255
9018     STA $E1
9020     LDX #10
9025     LDY #0
9030 CLOOP
9040     JSR GETCOLOR
9050     STA ($E0),Y
9060     INY 
9070     DEX 
9080     BNE CLOOP
9085     LDY #0
9087     LDX #10
9088     LDA #16
9089     STA $E2
9090 DRAWL1
9100     LDA ($E0),Y
9110 DR00 STA $6200
9120 DR01 STA $6201
9130 DR02 STA $6202
9140 DR03 STA $6203
9149     CLC 
9150     LDA DR00+1
9151     ADC #$04
9152     STA DR00+1
9153     BCC I1
9154     ADC #0
9155     STA DR00+2
9160 I1  CLC 
9161     LDA DR01+1
9162     ADC #$04
9163     STA DR01+1
9164     BCC I2
9165     ADC #0
9166     STA DR01+2
9170 I2  CLC 
9171     LDA DR02+1
9172     ADC #$04
9173     STA DR02+1
9174     BCC I3
9175     ADC #0
9176     STA DR02+2
9180 I3  CLC 
9181     LDA DR03+1
9182     ADC #$04
9183     STA DR03+1
9184     BCC I4
9185     ADC #0
9186     STA DR03+2
9190 I4  INY 
9200     DEX 
9210     BNE DRAWL1
9220     LDY #0
9230     LDX #10
9240     DEC $E2
9250     BNE DRAWL1
9900 PXDATA .BYTE $00,$00,$00,$00,$00
9910     .BYTE $00,$00,$00,$00,$00
